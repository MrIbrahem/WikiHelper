{% extends "base.html" %}

{% block title %}Edit {{ slug }} - Wiki Ref Manager{% endblock %}

{% block content %}
<h1>Edit Workspace: <code>{{ slug }}</code></h1>

<script>
    // document.addEventListener('DOMContentLoaded', function () {
    function changeDirection(direction) {
        const textarea = document.getElementById('editable_content');
        if (direction === 'rtl') {
            textarea.classList.remove('ltr-mode');
            textarea.classList.add('rtl-mode');
        } else {
            textarea.classList.remove('rtl-mode');
            textarea.classList.add('ltr-mode');
        }
    }

    // });
</script>

<!-- <p class="breadcrumb">
    <a href="{{ url_for('index') }}">Home</a> &raquo;
    <a href="{{ url_for('browse_workspace', slug=slug) }}">{{ slug }}</a> &raquo;
    Edit
</p> -->

<form method="POST">
    <div class="dir-switch">
        <button class="dir-btn" onclick="changeDirection('ltr')" title="Left to Right">
            <span class="icon">→</span> LTR
        </button>
        <button class="dir-btn" onclick="changeDirection('rtl')" title="Right to Left">
            <span class="icon">←</span> RTL
        </button>
    </div>

    <div class="form-group">
        <label for="status">Status</label>
        <select name="status" id="status" class="form-control">
            <option value="processing" {% if meta and meta.status == 'processing' %}selected{% endif %}>Processing
            </option>
            <option value="done" {% if meta and meta.status == 'done' %}selected{% endif %}>Done</option>
        </select>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">Save &amp; Restore References</button>
        <a href="{{ url_for('browse_workspace', slug=slug) }}" class="btn btn-secondary">Browse Files</a>
    </div>
    <div class="edit-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <div class="form-group">
            <label for="editable_content">Editable Content (editable.wiki)</label>
            <small>
                Edit the text below. References have been replaced with placeholders like [ref1], [ref2], etc.
                Keep these placeholders if you want to preserve the references.
            </small>
            <textarea id="editable_content" name="editable_content" rows="25"
                class="editor">{{ editable_content }}</textarea>
        </div>

    </div>
</form>

{% if restored_content %}
<div class="preview-section">
    <h2>Preview: Restored Content (restored.wiki)</h2>
    <small>This is the result after restoring the reference placeholders.</small>
    <pre class="preview-content">{{ restored_content }}</pre>
</div>
{% endif %}
{% endblock %}
